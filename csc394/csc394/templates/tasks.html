<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        var todo = todo || {},
            data = JSON.parse(localStorage.getItem("todoData"));

        data = data || {};

        (function (todo, data, $) {

            var defaults = {
                todoTask: "todo-task",
                todoHeader: "task-header",
                todoDate: "task-date",
                todoDescription: "task-description",
                taskId: "task-",
                formId: "todo-form",
                dataAttribute: "data",
                deleteDiv: "delete-div"
            },
                codes = {
                    "1": "#pending",
                    "2": "#inProgress",
                    "3": "#completed"
                };

            todo.init = function (options) {

                options = options || {};
                options = $.extend({}, defaults, options);

                $.each(data, function (index, params) {
                    generateElement(params);
                });

                $.each(codes, function (index, value) {
                    $(value).droppable({
                        drop: function (event, ui) {
                            var element = ui.helper,
                                css_id = element.attr("id"),
                                id = css_id.replace(options.taskId, ""),
                                object = data[id];

                            console.log(data[id]);

                            removeElement(object);

                            object.code = index;

                            generateElement(object);

                            data[id] = object;
                            localStorage.setItem("todoData", JSON.stringify(data));

                            $("#" + defaults.deleteDiv).hide();
                        }
                    });
                });

                $("#" + options.deleteDiv).droppable({
                    drop: function (event, ui) {
                        var element = ui.helper,
                            css_id = element.attr("id"),
                            id = css_id.replace(options.taskId, ""),
                            object = data[id];

                        removeElement(object);

                        delete data[id];
                        localStorage.setItem("todoData", JSON.stringify(data));

                        $("#" + defaults.deleteDiv).hide();
                    }
                });
            };


            //Add Task
            var generateElement = function (params) {
                var parent = $(codes[params.code]),
                    wrapper,
                    wrapperTitle,
                    wrapperDescription,
                    wrapperDate;

                console.log(parent);

                if (!parent)
                    return;

                wrapper = $("<div />", {
                    "class": defaults.todoTask,
                    "id": defaults.taskId + params.id,
                    "data": params.id
                }).appendTo(parent);

                wrapper.draggable({
                    start: function () {
                        $("#" + defaults.deleteDiv).show();
                    },
                    stop: function () {
                        $("#" + defaults.deleteDiv).hide();
                    }
                });


                wrapperTitle = $("<div />", {
                    "class": defaults.todoHeader,
                    "text": params.title
                }).appendTo(wrapper);

                wrapperDate = $("<div />", {
                    "class": defaults.todoDate,
                    "text": params.date
                }).appendTo(wrapper);

                wrapperDescription = $("<div />", {
                    "class": defaults.todoDescription,
                    "text": params.description
                }).appendTo(wrapper);

            };

            // Deleting Tasks
            var removeElement = function (params) {
                $("#" + defaults.taskId + params.id).remove();
            };

            // Form
            todo.add = function () {
                var inputs = $("#" + defaults.formId + " :input"),
                    errorMessage = "Title can not be empty",
                    id,
                    title,
                    description,
                    date,
                    tempData;

                if (inputs.length !== 4)
                    return;

                title = inputs[0].value;
                description = inputs[1].value;
                date = inputs[2].value;

                if (!title) {
                    generateDialog(errorMessage);
                    return;
                }

                id = new Date().getTime();

                tempData = {
                    id: id,
                    code: "1",
                    title: title,
                    date: date,
                    description: description
                };

                //Saving element in local storage
                data[id] = tempData;
                localStorage.setItem("todoData", JSON.stringify(data));

                //Generate Todo Element
                generateElement(tempData);

                //Reset Form
                inputs[0].value = "";
                inputs[1].value = "";
                inputs[2].value = "";

            };

            var generateDialog = function (message) {
                var responseId = "response-dialog",
                    title = "Message",
                    responseDialog = $("#" + responseId),
                    buttonOptions;

                if (!responseDialog.length) {
                    responseDialog = $("<div />", {
                        title: title,
                        id: responseId
                    }).appendTo($("body"));
                }

                responseDialog.html(message);

                buttonOptions = {
                    "Ok": function () {
                        responseDialog.dialog("close");
                    }
                };

                responseDialog.dialog({
                    autoOpen: true,
                    width: 400,
                    modal: true,
                    closeOnEscape: true,
                    buttons: buttonOptions
                });
            };

            todo.clear = function () {
                data = {};
                localStorage.setItem("todoData", JSON.stringify(data));
                $("." + defaults.todoTask).remove();
            };

        })(todo, data, jQuery);
    </script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />

    <style>
        body {
            background-color: #374a5d;
            border: 0;
        }

        #container {
            margin: 0 auto;
            width: 1060px;
            min-height: 100%;
            background-color: transparent;
            border: 0px;
        }

        #header {
            font-size: 30px;
            text-align: center;
            margin-bottom: 15px;
            color: #fff;
        }

        .task-list {
            width: 250px;
            float: left;
            margin: 0 5px;
            background-color: #e3e3e3;
            min-height: 240px;
            border-radius: 10px;
            padding-bottom: 15px;
        }

        .task-list input,
        .task-list textarea {
            width: 240px;
            margin: 5px 5px;
        }

        .task-list input {
            height: 30px;
        }

        .task-list input[type="button"] {
            width: 150px;
            margin-top: 5px;
            margin-left: 50px;

        }

        /*Add a task section*/
        #formTodo {
            width: 250px;
            float: left;
            margin-left: 20px;
            margin-right: 15px;
            margin-top: 0px;
            background-color: #e3e3e3;
            min-height: 240px;
            border-radius: 10px;
            padding-bottom: 15px;


        }


        #formTodo input,
        #formTodo textarea {
            width: 220px;
            margin-left: 15px;
            margin-top: 3px;
            margin-bottom: 2px;
            /* margin: 1px 5px; */

        }

        #formTodo input {
            height: 25px;
        }


        .todo-task {
            border-radius: 5px;
            background-color: #fff;
            width: 230px;
            margin: 5px;
            padding: 5px;
        }

        .todo-task>.task-header {
            font-weight: bold;
        }

        .todo-task>.task-date {
            font-size: small;
            font-style: italic;
        }

        .todo-task>.task-description {
            font-size: smaller;
        }

        h1,
        h3 {
            text-align: center;
        }

        #delete-div {
            display: none;
            background-color: #fff;
            border: 3px dotted #000;
            margin: 10px;
            height: 75px;
            line-height: 75px;
            text-align: center;
        }

        .verticalLine {
            border-left: 6px dotted black;
            height: 250px;
            position: absolute;
            left: 26%;
            margin-left: 10px;
            top: 30;
        }
    </style>
    <meta charset="UTF-8">
    <title>{% block title %}D3L{% endblock %}</title>
    {% load staticfiles %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href='https://fonts.googleapis.com/css?family=Satisfy' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>


</head>

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <!-- Header -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#topNavBar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{% url 'login:dashboard' %}">Home</a>
            </div>

            <!-- Items -->
            <div class="collapse navbar-collapse" id="topNavBar">
                <ul class="nav navbar-nav">
                    <li class=""><a href="#">Timeline</a></li>
                    <li class=""><a href="{% url 'tasksPage' %}">Tasks</a></li>
                    <li class=""><a href="#">Chat</a></li>
                    <li class=""><a href="{% url 'login:logout_user' %}">Log Out</a></li>
                    <li class="nav navbar-nav navbar-left"><a href="#">Hello, {{ user.get_username }}.</a></li>
                </ul>
            </div>
        </div>
    </nav>


    <h1>Tasks</h1>

    {% block body %}
    {% endblock %}
    <div class="container">
        <div class="task-list" id="formTodo">
            <h3>Add a task</h3>
            <form id="todo-form" action="/addTodo/" method="post">{% csrf_token %}
                <input type="text" placeholder="Title" name="title" />
                <textarea placeholder="Description" name="content"></textarea>
                <input type="text" id="datepicker" placeholder="Due Date (dd/mm/yy)" name="date" />
                <input type="button" class="btn btn-primary" value="Add task" onclick="todo.add();" />
            </form>
            <input type="button" class="btn btn-primary" value="Clear all" onclick="todo.clear();" />
            <div id="delete-div">Drag Here to Delete</div>
        </div>
        <div class="verticalLine"></div>
        <div class="task-list" id="pending">
            <h3>To-Do</h3>
            <!-- {% for todo_item in all_items%}
            <div class="todo-task">
                <div class="task-header">{{ todo_item.title}}
                    <form action="/deleteTodo/{{todo_item.id}}/" style="float: right;" method="post">
                        {% csrf_token %}
                        <input type="submit" value="Delete Task" />
                    </form>
                </div>
                <div class="task-description">{{ todo_item.content}}</div>
                <div class="task-date">{{ todo_item.date}}
                    <a href="http://www.nike.com" style="float: right;">edit</a>
                </div>
            </div>
            {% endfor %} -->
        </div>
        <div class="task-list" id="inProgress">
            <h3>In Progress</h3>
        </div>
        <div class="task-list" id="completed">
            <h3>Completed</h3>
        </div>

    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
        integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        $("#datepicker").datepicker();
        $("#datepicker").datepicker("option", "dateFormat", "dd/mm/yy");
        todo.init();
    </script>

</body>

</html>